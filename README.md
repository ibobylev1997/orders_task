# Orders loader (SQLite)

## Что делает

- читает заказы из `orders-1.json`;
- создаёт SQLite-базу `orders.db` и таблицу `orders`;
- нормализует поля и конвертирует дату из ISO 8601;
- достаёт вложенное поле `customer.region` в столбец `customer_region`;
- логирует шаги и ошибки в `orders_loader.log` + консоль;
- не загружает дубли по `order_id`.

## Требования

- Python 3.8+
- Стандартная библиотека (используются `json`, `sqlite3`, `logging`, `datetime`)

## Как запустить

```bash
python load_orders.py
```

Ожидаемый сценарий:

1. В консоли увидите:
   - подключение к БД;
   - создание (или наличие) таблицы `orders`;
   - статистику по вставленным/пропущенным/ошибочным записям.
2. В каталоге появятся:
   - `orders.db` — SQLite-база данных;
   - `orders_loader.log` — файл логов.

## Структура таблицы

Таблица `orders`:

- `order_id` (TEXT, PRIMARY KEY)
- `status` (TEXT, NOT NULL)
- `date` (TIMESTAMP, NOT NULL) — дата из JSON `date`, сконвертированная через `datetime.fromisoformat`
- `amount` (REAL, NOT NULL)
- `customer_region` (TEXT, NOT NULL) — из `customer.region`
- `loaded_at` (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP) — время загрузки в БД

## Логирование

Логи пишутся:

- в консоль (уровень INFO и выше);
- в файл `orders_loader.log` (уровень DEBUG и выше).

Логируются:

- старт/завершение процесса;
- подключение к БД;
- создание схемы;
- чтение JSON и количество записей;
- количество вставленных/пропущенных/ошибочных записей;
- дубликаты (DEBUG);
- некорректные даты и отсутствующие поля (WARNING/ERROR).

## Проверка дублей

- Перед загрузкой в БД читается множество всех `order_id` из таблицы.
- Для каждой записи из JSON:
  - если `order_id` уже есть в БД — запись пропускается, логируется как дубликат;
  - иначе выполняется `INSERT` и `order_id` добавляется в локальное множество.

Это гарантирует, что при повторном запуске `load_orders.py` одни и те же заказы не будут загружены второй раз.
