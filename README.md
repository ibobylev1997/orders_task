# Orders loader (SQLite)

Небольшой ETL-скрипт, который читает заказы из JSON и складывает их в SQLite

## Что внутри

- Читает `orders-1.json`
- Создаёт базу `orders.db` и таблицу `orders`, если их ещё нет
- Преобразует поле `date` из строки ISO 8601 в datetime и сохраняет в БД
- Достаёт вложенный `customer.region` и пишет его в `customer_region`
- Логирует ключевые шаги и ошибки в консоль и файл `orders_loader.log`
- Не загружает повторно заказы с тем же `order_id`

## Как запустить

1. Положите рядом с `load_orders.py` файл `orders-1.json`
2. Запустите

```bash
python load_orders.py
```

После запуска рядом появятся:

- `orders.db` — база данных SQLite
- `orders_loader.log` — файл логов

## Как устроена таблица

Таблица `orders` хранит только нужные поля

- `order_id` — идентификатор заказа, PRIMARY KEY
- `status` — статус заказа
- `date` — дата заказа
- `amount` — сумма заказа
- `customer_region` — регион клиента из `customer.region`
- `loaded_at` — когда запись попала в БД

## Что логируется

В логи попадают:

- старт и завершение процесса
- чтение JSON и количество записей
- создание схемы и подключение к БД
- итоги загрузки, сколько вставлено, сколько пропущено как дубли, сколько ошибок
- детали по дублям на уровне DEBUG
- проблемные записи, например некорректная дата или отсутствующие поля

## Проверка дублей

Дедупликация сделана по `order_id`

- перед вставкой скрипт читает все `order_id`, которые уже есть в таблице
- если новый `order_id` уже существует, запись пропускается
- при повторном запуске скрипта те же заказы не продублируются
